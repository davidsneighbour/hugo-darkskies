////
/// @group 0-setup
/// @author Patrick Kollitsch
/// @access public
/// @since 1.2024.0
////

@charset 'utf-8';

@use "sass:map";
@use "sass:color";
@use "sass:math";
@use "sass:string";
@use "modules/mixins/scrollbar" as dnb;
@use "modules/colors" as dnbcolors;

// A comment about @import vs @use
// Bootstrap seems to not yet support @use, so we use @import for now.
// In regards to the DNB theme, we @use modules and all @imports are deprecated.

// BS: Configuration
@import "bootstrap/scss/functions";

// MARK: Settings Fonts

/// default directory to locate webfonts
/// @type string
$fontdir: "/assets/webfonts" !default;

/// @link https://github.com/NDISCOVER/Exo-2.0
/// @access private
@font-face {
  font-family: Exo2;
  src: url("#{$fontdir}/exo/normal.woff2") format("woff2") tech("variations"),
  url("#{$fontdir}/exo/normal.woff2") format("woff2-variations");
  font-weight: 100 900;
  font-style: normal;
  font-display: fallback;
  text-rendering: optimizelegibility;
}

/// @link https://github.com/NDISCOVER/Exo-2.0
/// @access private
@font-face {
  font-family: Exo2;
  src: url("#{$fontdir}/exo/italic.woff2") format("woff2") tech("variations"),
  url("#{$fontdir}/exo/italic.woff2") format("woff2-variations");
  font-weight: 100 900;
  font-style: italic;
  font-display: swap;
  text-rendering: optimizelegibility;
}

/// @link https://github.com/JetBrains/JetBrainsMono
/// @access private
@font-face {
  font-family: JetBrainsMono;
  src: url("#{$fontdir}/jetbrainsmono/JetBrainsMono[wght].woff2") format("woff2") tech("variations"),
  url("#{$fontdir}/jetbrainsmono/JetBrainsMono[wght].woff2") format("woff2-variations");
  font-weight: 100 800;
  font-style: normal;
  font-display: fallback;
  text-rendering: optimizelegibility;
}

/// @link https://github.com/JetBrains/JetBrainsMono
/// @access private
@font-face {
  font-family: JetBrainsMono;
  src: url("#{$fontdir}/jetbrainsmono/JetBrainsMono-Italic[wght].woff2") format("woff2") tech("variations"),
  url("#{$fontdir}/jetbrainsmono/JetBrainsMono-Italic[wght].woff2") format("woff2-variations");
  font-weight: 100 800;
  font-style: italic;
  font-display: swap;
  text-rendering: optimizelegibility;
}

/// @link https://github.com/etunni/changa-one
/// @access private
@font-face {
  font-family: Changa;
  src: url('#{$fontdir}/changa/changaone-regular-webfont.woff2') format('woff2'),
  url('#{$fontdir}/changa/changaone-regular-webfont.woff') format('woff');
  font-weight: normal;
  font-style: normal;
  font-display: fallback;
  text-rendering: optimizelegibility;
}

/// @link https://github.com/etunni/changa-one
/// @access private
@font-face {
  font-family: Changa;
  src: url('#{$fontdir}/changa/changaone-italic-webfont.woff2') format('woff2'),
  url('#{$fontdir}/changa/changaone-italic-webfont.woff') format('woff');
  font-weight: normal;
  font-style: italic;
  font-display: swap;
  text-rendering: optimizelegibility;
}

/// font family setup
$ff-headline: Changa, sans-serif;
$ff-body: Exo2, sans-serif;
$ff-mono: JetBrainsMono, monospace;

// MARK: Settings Colors

// :root {
//   @each $name, $value in dnbcolors.$colors {
//     --color-#{$name}: #{$value};
//   }
// }

/// default dark background color
/// @type color
$dark-1: map.get(dnbcolors.$colors, "black") !default;

/// default dark accented background color
/// @type color
$dark-2: map.get(dnbcolors.$colors, "midnightblue") !default;

/// default light background color
/// @type color
$light-1: map.get(dnbcolors.$colors, "whitesmoke") !default;

/// default light accented background color
/// @type color
$light-2: map.get(dnbcolors.$colors, "gainsboro") !default;

/// theme primary (accent) color
/// @type color
$primary: map.get(dnbcolors.$colors, "red") !default;

/// contrast between sections in dark theme
/// @type percentage
$dark-contrast: 12% !default;

/// contrast between sections in light theme
/// @type percentage
$light-contrast: 7% !default;

// MARK: Settings Theme

:root {
  /// @link https://developer.chrome.com/docs/css-ui/animate-to-height-auto/
  interpolate-size: allow-keywords;
}

:root,
[data-bs-theme="dark"] {
  color-scheme: dark;

  --bs-body-bg: $dark-2;
  --bs-primary: $primary;
}

[data-bs-theme="light"] {
  color-scheme: light;

  --bs-body-bg: $light-1;
  --bs-primary: $dark-2;
}

/// [data-bs-theme=dark] instead of media-queries
/// @link https://getbootstrap.com/docs/5.3/customize/color-modes/#custom-color-modes
$color-mode-type: data;

/// color settings
$danger-text-emphasis: $primary;

/// global elements
$border-width: 2px;

/// body
$body-bg-dark: $dark-1;
$body-bg: $light-1;

/// typography
/// based on golden ratio
///
/// Size (px)	Height (px)
/// 47	74 52
/// 37	59 32
/// 29	48 20
/// 23	39 12
/// 18	32  7
/// 14	26  4
$font-size-root: 18px;
$font-size-base: 1rem;
$font-family-sans-serif: $ff-body;
$font-family-monospace: $ff-mono;

/// font sizes
$font-weight-lighter: 100;
$font-weight-light: 200;
$font-weight-normal: 300;
$font-weight-medium: 400;
$font-weight-semibold: 500;
$font-weight-bold: 600;
$font-weight-bolder: 700;

/// headings
$headings-font-family: $ff-headline;
$headings-font-weight: 400;
$h1-font-size: $font-size-base * 2.05;
$h2-font-size: $font-size-base * 1.6;
$h3-font-size: $font-size-base * 1.25;
$h4-font-size: $font-size-base;
$h5-font-size: $font-size-base * 0.8;
$h6-font-size: $font-size-base * 0.8;

/// component color
$component-active-color: var(--bs-dark);

/// links
$link-color: $primary;
$link-color-dark: $primary;
$link-hover-color: $primary;
$link-decoration: none;
$link-hover-decoration: underline;

/// badges
$badge-font-weight: 400;
$badge-font-size: 0.75em;

/// buttons
$btn-font-family: $ff-headline;

/// navigation
/// @link https://getbootstrap.com/docs/5.3/components/navbar/
/// @link https://getbootstrap.com/docs/5.3/components/navs-tabs/
$navbar-padding-y: 0;
$navbar-padding-x: 0;
$nav-link-font-size: 1rem;
$navbar-light-hover-color: $primary;
$navbar-light-active-color: $primary;
$navbar-dark-hover-color: $primary;
$navbar-dark-active-color: $primary;

/// navbar toggler
$navbar-toggler-padding-y: .25rem;
$navbar-toggler-padding-x: .5rem;
$navbar-toggler-transition: box-shadow .15s ease-in-out;

/// settings
$enable-shadows: true;
$enable-negative-margins: true;
$enable-rounded: true;
$enable-important-utilities: false;

/// theme settings
$heading-height: 70px;
$aspect-ratio: math.div(2, 1); /* 2:1. 2 would be enough, but then we would
                                        forget how to set other aspect ratios
                                        until next time ;] */

/// mark tag
$mark-color: var(--bs-gray-dark);
$mark-bg: var(--bs-primary);
$mark-padding: 0 0.1875em;

/// root setup
:root {
  // @link https://drafts.csswg.org/css-ui-4/#widget-accent
  // @link https://caniuse.com/?search=accent-color
  accent-color: var(--bs-primary);
  color-scheme: dark light;

  // transition setup and default values
  --duration: 0.5s;
  --timing: ease;

  --flow-space: var($spacer * 2, 1em);

  transition:
    color var(--duration) var(--timing),
    background-color var(--duration) var(--timing);
}

@media (prefers-reduced-motion) {

  *,
  *::before,
  *::after {
    animation-duration: 0s !important;
    transition: none !important;
    scroll-behavior: auto !important;
  }
}

/// breadcrumbs setup
/* stylelint-disable-next-line scss/no-global-function-names -- quote alone is ok */
$breadcrumb-divider: string.quote(‚ü©);
$breadcrumb-font-size: 0.8rem;
$breadcrumb-margin-bottom: 0.25rem;
$breadcrumb-divider-color: var(--bs-tertiary-color);

$border-radius: 5px;

/// code
$code-font-size: 90%;
// $code-color: $pink !default;

@import "01-settings/utilities";

// MARK: Bootstrap Modules

// BS: theme settings
@import "bootstrap/scss/variables";
@import "bootstrap/scss/variables-dark";

// DNB: map overrides
@import "01-settings/maps";

// BS: other required parts
@import "bootstrap/scss/maps";
@import "bootstrap/scss/mixins";
@import "bootstrap/scss/utilities";

// BS: all other components as required
@import "bootstrap/scss/root";
@import "bootstrap/scss/reboot";
@import "bootstrap/scss/type";
@import "bootstrap/scss/images";
@import "bootstrap/scss/containers";
@import "bootstrap/scss/grid";
@import "bootstrap/scss/tables";
@import "bootstrap/scss/forms";
@import "bootstrap/scss/buttons";
@import "bootstrap/scss/transitions";
@import "bootstrap/scss/dropdown";

// @import 'bootstrap/scss/button-group';
@import "bootstrap/scss/nav";
@import "bootstrap/scss/navbar";
@import "bootstrap/scss/card";

// @import 'bootstrap/scss/accordion';
@import "bootstrap/scss/breadcrumb";
@import "bootstrap/scss/pagination";
@import "bootstrap/scss/badge";
@import "bootstrap/scss/alert";
@import "bootstrap/scss/progress";

// @import 'bootstrap/scss/list-group';
@import "bootstrap/scss/close";

// @import 'bootstrap/scss/toasts';
// @import 'bootstrap/scss/modal';
@import "bootstrap/scss/tooltip";

// @import 'bootstrap/scss/popover';
// @import "bootstrap/scss/carousel";

// @import 'bootstrap/scss/spinners';
// @import 'bootstrap/scss/offcanvas';
// @import 'bootstrap/scss/placeholders';

// BS: helpers
@import "bootstrap/scss/helpers";

// BS: utilities API
@import "bootstrap/scss/utilities/api";

// MARK: DNB Dark Skies Theme

html {
  scroll-behavior: smooth;

  background: var(--dnb-bg-image) no-repeat center center fixed;
  background-size: cover;

  &:has(.kind-404) {
    background: url("/assets/images/404.jpg") no-repeat center center fixed;
    background-size: cover;
  }

}

body {
  background-color: color-mix(in srgb, var(--bs-body-bg) 90%, transparent);
  font-feature-settings: "liga" on, "calt" on;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizelegibility;
}

a {

  transition: color 0.5s linear;

  text-decoration-skip-ink: all;
  text-decoration-skip: leading-spaces edges;

  box-decoration-break: clone;

}

/* content area */
main {
  padding-top: 30px;
  margin: 0 auto;
  max-width: clamp(320px, 90%, 60rem);

  @extend .min-vh-100;

  @include media-breakpoint-up(md) {
    padding-top: 90px;
  }
}

article {
  width: 100%;

  img {
    max-width: 100%;
  }
}

/// A container for the article image
.post-slider {

  figure {
    @extend .w-100;
    @extend .overflow-hidden;
    @extend .rounded-top;
    @extend .position-relative;

    picture,
    img,
    .iframe-border,
    video {
      object-fit: cover;
      aspect-ratio: 2/1;

      @extend .overflow-hidden;
      @extend .rounded;
      @extend .w-100;
    }

  }
}

.section--content article {
  border: 1px solid rgba(0, 0, 0, 0.2);
  background-color: rgba(255, 255, 255, 0.05);
  transition: background 2s;

  &:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }


  @extend .rounded;

}

.breadcrumb {
  margin-right: math.div($spacer, 2);

  .breadcrumb-item {
    float: none;
    overflow-x: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
}

a.text-hover-decoration-none:hover {
  @extend .text-decoration-none;
}

abbr {
  letter-spacing: 0.1em;
}

.alert {

  // @todo make this look good
  // @include media-breakpoint-up(md) {
  // display: block;
  // margin: 0 -60px;
  // }

  a {
    /// adds colors to all links inside alerts
    @extend .alert-link;
  }

  /// remove unnessary margin from last paragraph in alerts
  p:last-of-type {
    @extend .mb-0;
  }

  .icon--bootstrap {
    @extend .shadow-lg;
    background-color: var(--bs-dark-bg-subtle);
    border: 2px solid var(--bs-dark-border-subtle);
    padding: 8px;
    border-radius: 999px;
    line-height: 1;
    display: inline-block;
    position: absolute;
    top: -15px;
    left: -25px;
  }

}

.is--clickable {
  cursor: pointer;
}

input:autofill {
  @extend .border-1;
  @extend .border-primary;
}

textarea {
  field-sizing: content; // default is `fixed`
  height: 10rem;
  min-height: 10rem;
}

.section--sitetitle {
  background-color: rgba(0, 0, 0, .2);
  transition: background-color 2s;
}

@include color-mode(light) {
  .section--sitetitle {
    background-color: rgba(255, 255, 255, .2);
  }
}

.site-title {
  @include media-breakpoint-down(sm) {
    font-size: 6vw;
  }

  @include media-breakpoint-up(sm) {
    font-size: 12vw;
  }

  @include media-breakpoint-up(xl) {
    font-size: 800%;
  }

  @extend .fw-semibold;
  @extend .lh-1;
  @extend .text-center;
  @extend .text-primary;

  a {
    @extend .text-decoration-none;

    :hover {
      @extend .text-decoration-none;
    }
  }

}

/* highlighting via `mark` tag */
$mark-lighten-percentage: 20%; // Configurable percentage for lightening

/// @name mark-[error|warning|success|info]
///
/// the $colors here is the bootstrap colors, not dnb colors array
@each $name, $color in $colors {
  $light-color: color.mix(white, $color, $mark-lighten-percentage);

  /* lighten($color, $mark-lighten-percentage); */

  .mark-#{$name} {
    display: inline-block;
    background: linear-gradient(100deg,
      #{$light-color}00 1%,
      #{$light-color} 2.5%,
      #{$light-color}80 5.7%,
      #{$light-color}1a 93%,
      #{$light-color}b4 95%,
      #{$light-color}00 98%),
    linear-gradient(182deg, #{$light-color}00, #{$light-color}4d 8%, #{$light-color}00 15%);
  }
}

mark {
  @extend .mark-green;
  @extend .rounded;
}

code,
kbd,
pre,
samp {
  font-family: $ff-mono;
  font-variant-ligatures: common-ligatures;
  font-feature-settings: "liga", "clig", "dlig", "calt", "zero", "ss02", "cv18", "cv19", "cv20";
}

/// @link https://clagnut.com/blog/2424
h1,
h2,
h3,
h4,
h5,
h6,
caption,
figcaption {
  text-wrap: balance;
}

// DNB: prose - article content formatting
@include dnb.configure(
  $border-radius: $border-radius
);
@include dnb.scrollbar;
@include dnb.scrollbar(".prose", 3px);

.prose {

  /* max-inline-size: 55rem; */
  margin-inline: auto;

  margin-bottom: 1rem;

  font-variant-numeric: oldstyle-nums;

  /* @link https://kilianvalkhof.com/2022/css-html/your-css-reset-needs-text-size-adjust-probably/ */
  -moz-text-size-adjust: none;
  -webkit-text-size-adjust: none;
  text-size-adjust: none;

  line-height: 1.5;
  text-decoration-skip-ink: auto;
  font-optical-sizing: auto;
  font-variant-ligatures: common-ligatures no-discretionary-ligatures no-historical-ligatures contextual;
  font-kerning: normal;

  /* @todo balance for headings, pretty for floating text */
  text-wrap: pretty;
  font-variant-numeric: oldstyle-nums proportional-nums;
  font-size-adjust: 0.458;

  /* hyphenation
   @link https://clagnut.com/blog/2395/ */
  -webkit-hyphens: auto;
  -webkit-hyphenate-limit-before: 4;
  -webkit-hyphenate-limit-after: 3;
  -webkit-hyphenate-limit-lines: 2;
  hyphens: auto;
  hyphenate-limit-chars: 7 4 3;
  hyphenate-limit-lines: 2;
  hyphenate-limit-zone: 8%;
  hyphenate-limit-last: always;

  @import "05-prose/prose";
  @import "05-prose/tables";

  // @TODO perfect candidate for a module to @use with color settings.
  .light & {
    // light theme syntax highlighting
    @import "05-prose/syntax/light";
  }

  .dark & {
    // dark theme syntax highlighting
    @import "05-prose/syntax/dark";
  }

}

/// alerts
.alert-dnb-dark {
  --bs-alert-bg: rgba(0, 0, 0, 0.1) !important;
  --bs-alert-border-color: rgba(0, 0, 0, 0.2) !important;
}

.alert-dnb-light {
  --bs-alert-bg: rgba(, 0.1) !important;
  --bs-alert-border-color: rgba(0, 0, 0, 0.2) !important;
}

/// @todo integrate this into the theme
.fit-content {
  width: fit-content;
}

/// font family classes
.ff-headline {
  font-family: $ff-headline !important;
}

.ff-body {
  font-family: $ff-body !important;
}

.ff-jetbrains {
  font-family: $ff-mono !important;
}

/// fix navigation overflow for anchor links
:target {
  scroll-margin-top: $heading-height;
}

// MARK: DNB Utilities
/// truncate text with an ellipsis after x lines. extend .text-truncate with
/// .text-truncate-1, .text-truncate-2, etc.
@for $i from 1 through 10 {
  .text-truncate-#{$i} {
    display: -webkit-box !important;
    -webkit-line-clamp: #{$i};
    line-clamp: #{$i};
    -webkit-box-orient: vertical;
    white-space: normal;
  }
}

/// ribbons
.ribbon {
  font-size: 1rem;

  &.status--draft {
    color: $dark-2;
    background-color: $primary;
  }

  &.status--gohugo {
    color: $dark-1;
    background-color: $primary;
  }

  article:has(&) {
    @extend .position-relative;
  }
}

/* stylelint-disable plugin/no-unsupported-browser-features -- Opera Mini, muahahaha */
/// coloring the selection in the browser
::selection {
  color: var(--bs-body-bg);
  text-shadow: none;
  background-color: var(--bs-primary);
}

/// hyphenation for paragraphs and stuff
.hyphenate {
  overflow-wrap: break-word;
  word-wrap: break-word;
  hyphens: auto;
  hyphenate-limit-chars: 10 4 4;
}

// MARK: DNB Footer
#footer {

  .widget.social-media {

    a:link,
    a:hover {
      svg {
        @extend .cx-36;
        @extend .cy-36;
        @extend .p-0;
        @extend .m-0;
      }

      @extend .px-3;
    }
  }

  .light & {
    color: $dark-1;
  }

  .dark & {
    color: $light-1;
  }

  .container {
    max-width: 1200px;
  }

  a {
    color: $primary;

    @extend .text-decoration-none;

    &:hover {
      color: var(--bs-primary-color);

      @extend .text-decoration-none;
    }
  }
}

// MARK: DNB Navigation
.navbar {
  transition: background-color 2s;

  .navbar-toggler {
    line-height: 0.8;
  }

  .navbar-toggler-icon {
    height: 1.5rem;
    width: 1.5rem;
  }

  .navbar-brand {
    transition: opacity 1.5s ease, transform 0.3s ease;
    opacity: 0;
    transform: translateY(-10px); // Start slightly above
    display: block; // Ensure the element is always in the document flow
    visibility: hidden; // Ensure it's hidden from screen readers when invisible

    &.sticky-visible {
      opacity: 1;
      transform: translateY(0); // Move back to its normal position
      visibility: visible; // Make it accessible to screen readers
    }
  }

  body.dark & {
    background-color: color.scale(map.get(dnbcolors.$colors, "veryblack"), $alpha: -80%);
  }

  body.light & {
    background-color: color.scale(map.get(dnbcolors.$colors, "white"),
        $alpha: -80%);
  }

  body.dark.nav-state2 & {
    background-color: color.scale(map.get(dnbcolors.$colors, "veryblack"),
        $alpha: -20%);
    backdrop-filter: saturate(180%) blur(20px);
  }

  body.light.nav-state2 & {
    background-color: color.scale(map.get(dnbcolors.$colors, "white"),
        $alpha: -20%);
    backdrop-filter: saturate(180%) blur(20px);
  }

  .icon--bootstrap {
    margin-right: 0.25rem;
  }

}

.progress {
  background: linear-gradient(90deg,
      map.get(dnbcolors.$colors, "red") 0%,
      map.get(dnbcolors.$colors, "orange") 12%,
      map.get(dnbcolors.$colors, "yellow") 25%,
      map.get(dnbcolors.$colors, "springgreen") 37%,
      map.get(dnbcolors.$colors, "deepskyblue") 50%,
      map.get(dnbcolors.$colors, "blueviolet") 62%,
      map.get(dnbcolors.$colors, "mediumvioletred") 75%,
      map.get(dnbcolors.$colors, "deeppink") 87%,
      map.get(dnbcolors.$colors, "red") 100%);
}

// DNB: Components
@import "04-components/search";
@import "04-components/theme-toggle";

// DNB: plugins (imported from node_modules)
@import "lite-yt-embed";
@import "debugprint";
@import "plugins/clipboard";
@import "auditor";
